{"ast":null,"code":"import React,{useState,useEffect,useCallback,useRef}from\"react\";import{Routes,Route,Link}from\"react-router-dom\";import{Container,Navbar,Nav}from\"react-bootstrap\";import{GoogleOAuthProvider}from\"@react-oauth/google\";import MoviesList from\"./components/MoviesList\";import Movie from\"./components/Movie\";import AddReview from\"./components/AddReview\";import Login from\"./components/Login\";import Logout from\"./components/Logout\";import Favorites from\"./components/Favorites\";import{getFavorites,updateFavorites}from\"./services/favorites\";import\"./App.css\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const clientId=\"510875697640-tck18ehc7i280k3k7qphjthjrn9l0hbd.apps.googleusercontent.com\";function App(){const[user,setUser]=useState(null);const[favorites,setFavorites]=useState([]);const isFirstLoad=useRef(true);const loadFavorites=useCallback(async()=>{console.log('Loading favorites for user:',user);if(user&&user.googleId){try{const data=await getFavorites(user.googleId);console.log('Favorites data loaded:',data);setFavorites(data.favorites||[]);}catch(e){console.error('Error loading favorites:',e);setFavorites([]);}}else{console.log('No user or googleId, setting empty favorites');setFavorites([]);}},[user,setFavorites]);useEffect(()=>{const initializeFavorites=async()=>{await loadFavorites();isFirstLoad.current=false;};initializeFavorites();},[loadFavorites]);useEffect(()=>{if(!isFirstLoad.current&&user&&user.googleId){const saveFavorites=async()=>{try{console.log('Saving favorites:',favorites,'for user:',user.googleId);await updateFavorites(user.googleId,favorites);console.log('Favorites saved successfully');}catch(error){console.error('Error updating favorites:',error);}};saveFavorites();}},[favorites,user]);useEffect(()=>{console.log(\"user\",user);},[user]);const addFavorite=movieId=>{console.log('Adding favorite:',movieId,'User:',user);if(!favorites.includes(movieId)){setFavorites(prev=>[...prev,movieId]);}};const deleteFavorite=movieId=>{console.log('Deleting favorite:',movieId,'User:',user);setFavorites(prev=>prev.filter(f=>f!==movieId));};useEffect(()=>{let loginData=JSON.parse(localStorage.getItem(\"login\"));if(loginData){let loginExp=loginData.exp;let now=Date.now()/1000;if(now<loginExp){setUser(loginData);}else{localStorage.setItem(\"login\",null);}}},[]);return/*#__PURE__*/_jsx(GoogleOAuthProvider,{clientId:clientId,children:/*#__PURE__*/_jsxs(\"div\",{className:\"App\",children:[/*#__PURE__*/_jsx(Navbar,{bg:\"primary\",expand:\"lg\",sticky:\"top\",variant:\"dark\",children:/*#__PURE__*/_jsxs(Container,{className:\"container-fluid\",children:[/*#__PURE__*/_jsxs(Navbar.Brand,{href:\"/\",className:\"brand\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"/images/movies-logo.png\",alt:\"movies logo\",className:\"moviesLogo\",onError:e=>{console.log(\"Logo failed to load:\",e.target.src);e.target.style.display='none';},onLoad:()=>{console.log(\"Logo loaded successfully\");}}),\"MOVIE TIME\"]}),/*#__PURE__*/_jsx(Navbar.Toggle,{\"aria-controls\":\"basic-navbar-nav\"}),/*#__PURE__*/_jsxs(Navbar.Collapse,{id:\"responsive-navbar-nav\",children:[/*#__PURE__*/_jsxs(Nav,{className:\"ml-auto\",children:[/*#__PURE__*/_jsx(Nav.Link,{as:Link,to:\"/movies\",className:\"link\",children:\"Movies\"}),/*#__PURE__*/_jsx(Nav.Link,{as:Link,to:\"/favorites\",className:\"link\",children:\"Favorites\"})]}),user?/*#__PURE__*/_jsx(Logout,{setUser:setUser,clientId:clientId}):/*#__PURE__*/_jsx(Login,{setUser:setUser})]})]})}),/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{exact:true,path:\"/\",element:/*#__PURE__*/_jsx(MoviesList,{user:user,favorites:favorites,addFavorite:addFavorite,deleteFavorite:deleteFavorite})}),/*#__PURE__*/_jsx(Route,{exact:true,path:\"/movies\",element:/*#__PURE__*/_jsx(MoviesList,{user:user,favorites:favorites,addFavorite:addFavorite,deleteFavorite:deleteFavorite})}),/*#__PURE__*/_jsx(Route,{path:\"/movies/:id\",element:/*#__PURE__*/_jsx(Movie,{user:user})}),/*#__PURE__*/_jsx(Route,{path:\"/movies/:id/review\",element:/*#__PURE__*/_jsx(AddReview,{user:user})}),/*#__PURE__*/_jsx(Route,{path:\"/favorites\",element:/*#__PURE__*/_jsx(Favorites,{user:user})})]})]})});}export default App;","map":{"version":3,"names":["React","useState","useEffect","useCallback","useRef","Routes","Route","Link","Container","Navbar","Nav","GoogleOAuthProvider","MoviesList","Movie","AddReview","Login","Logout","Favorites","getFavorites","updateFavorites","jsx","_jsx","jsxs","_jsxs","clientId","App","user","setUser","favorites","setFavorites","isFirstLoad","loadFavorites","console","log","googleId","data","e","error","initializeFavorites","current","saveFavorites","addFavorite","movieId","includes","prev","deleteFavorite","filter","f","loginData","JSON","parse","localStorage","getItem","loginExp","exp","now","Date","setItem","children","className","bg","expand","sticky","variant","Brand","href","src","alt","onError","target","style","display","onLoad","Toggle","Collapse","id","as","to","exact","path","element"],"sources":["/Users/tenmoutheshark/Desktop/mern-stack-project-backend-Tenmou-Vi/frontend/src/App.js"],"sourcesContent":["import React, { useState, useEffect, useCallback, useRef } from \"react\";\nimport { Routes, Route, Link } from \"react-router-dom\";\nimport { Container, Navbar, Nav } from \"react-bootstrap\";\nimport { GoogleOAuthProvider } from \"@react-oauth/google\";\n\nimport MoviesList from \"./components/MoviesList\";\nimport Movie from \"./components/Movie\";\nimport AddReview from \"./components/AddReview\";\nimport Login from \"./components/Login\";\nimport Logout from \"./components/Logout\";\nimport Favorites from \"./components/Favorites\";\n\nimport { getFavorites, updateFavorites } from \"./services/favorites\";\n\nimport \"./App.css\";\n\nconst clientId = \"510875697640-tck18ehc7i280k3k7qphjthjrn9l0hbd.apps.googleusercontent.com\";\n\nfunction App() {\n  const [user, setUser] = useState(null);\n  const [favorites, setFavorites] = useState([]);\n  const isFirstLoad = useRef(true);\n\n  const loadFavorites = useCallback(async () => {\n    console.log('Loading favorites for user:', user);\n    if (user && user.googleId) {\n      try {\n        const data = await getFavorites(user.googleId);\n        console.log('Favorites data loaded:', data);\n        setFavorites(data.favorites || []);\n      } catch (e) {\n        console.error('Error loading favorites:', e);\n        setFavorites([]);\n      }\n    } else {\n      console.log('No user or googleId, setting empty favorites');\n      setFavorites([]);\n    }\n  }, [user, setFavorites]);\n\n  useEffect(() => {\n    const initializeFavorites = async () => {\n      await loadFavorites();\n      isFirstLoad.current = false;\n    };\n    initializeFavorites();\n  }, [loadFavorites]);\n\n  useEffect(() => {\n    if (!isFirstLoad.current && user && user.googleId) {\n      const saveFavorites = async () => {\n        try {\n          console.log('Saving favorites:', favorites, 'for user:', user.googleId);\n          await updateFavorites(user.googleId, favorites);\n          console.log('Favorites saved successfully');\n        } catch (error) {\n          console.error('Error updating favorites:', error);\n        }\n      };\n      saveFavorites();\n    }\n  }, [favorites, user]);\n\n  useEffect(() => {\n    console.log(\"user\", user);\n  }, [user]);\n\n  const addFavorite = (movieId) => {\n    console.log('Adding favorite:', movieId, 'User:', user);\n    if (!favorites.includes(movieId)) {\n      setFavorites((prev) => [...prev, movieId]);\n    }\n  };\n\n  const deleteFavorite = (movieId) => {\n    console.log('Deleting favorite:', movieId, 'User:', user);\n    setFavorites((prev) => prev.filter((f) => f !== movieId));\n  };\n\n  useEffect(() => {\n    let loginData = JSON.parse(localStorage.getItem(\"login\"));\n    if (loginData) {\n      let loginExp = loginData.exp;\n      let now = Date.now() / 1000;\n      if (now < loginExp) {\n        setUser(loginData);\n      } else {\n        localStorage.setItem(\"login\", null);\n      }\n    }\n  }, []);\n\n  return (\n    <GoogleOAuthProvider clientId={clientId}>\n      <div className=\"App\">\n        <Navbar bg=\"primary\" expand=\"lg\" sticky=\"top\" variant=\"dark\">\n          <Container className=\"container-fluid\">\n            <Navbar.Brand href=\"/\" className=\"brand\">\n              <img \n                src=\"/images/movies-logo.png\" \n                alt=\"movies logo\" \n                className=\"moviesLogo\"\n                onError={(e) => {\n                  console.log(\"Logo failed to load:\", e.target.src);\n                  e.target.style.display = 'none';\n                }}\n                onLoad={() => {\n                  console.log(\"Logo loaded successfully\");\n                }}\n              />\n              MOVIE TIME\n            </Navbar.Brand>\n            <Navbar.Toggle aria-controls=\"basic-navbar-nav\" />\n            <Navbar.Collapse id=\"responsive-navbar-nav\">\n              <Nav className=\"ml-auto\">\n                <Nav.Link as={Link} to=\"/movies\" className=\"link\">\n                  Movies\n                </Nav.Link>\n                <Nav.Link as={Link} to=\"/favorites\" className=\"link\">\n                  Favorites\n                </Nav.Link>\n              </Nav>\n              { user ? (\n                  <Logout setUser={setUser} clientId={clientId} />\n                ) : (\n                  <Login setUser={setUser} />\n              )}\n            </Navbar.Collapse>\n          </Container>\n        </Navbar>\n\n        <Routes>\n          <Route exact path={\"/\"} element={\n            <MoviesList\n              user={user}\n              favorites={favorites}\n              addFavorite={addFavorite}\n              deleteFavorite={deleteFavorite}\n            />\n          } />\n          <Route exact path={\"/movies\"} element={\n            <MoviesList\n              user={user}\n              favorites={favorites}\n              addFavorite={addFavorite}\n              deleteFavorite={deleteFavorite}\n            />\n          } />\n          <Route path={\"/movies/:id\"} element={\n            <Movie user={user} />\n          } />\n          <Route path={\"/movies/:id/review\"} element={<AddReview user={user} />} />\n          <Route path={\"/favorites\"} element={<Favorites user={user} />} />\n        </Routes>\n      </div>\n    </GoogleOAuthProvider>\n  );\n}\n\nexport default App; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}